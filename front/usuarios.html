<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Usuarios - MiniChangApp</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="navbar"></div>

  <main>
    <h2>ğŸ‘¥ Lista de usuarios</h2>
    <div id="loading" style="text-align: center; padding: 40px;">
      <div class="loading"></div>
      <p style="margin-top: 15px; color: #666;">Cargando usuarios...</p>
    </div>
    <ul id="usuarios" style="display: none;"></ul>
  </main>

  <div id="footer"></div>

  <script src="config.js"></script>
  
  <script>
    // ğŸ§± Carga de navbar y footer
    async function loadComponent(id, file) {
      const res = await fetch(file);
      const html = await res.text();
      document.getElementById(id).innerHTML = html;
    }
    loadComponent("navbar", "/components/navbar.html");
    loadComponent("footer", "/components/footer.html");

    // ğŸ§¾ Cargar usuarios
    async function cargarUsuarios() {
      try {
        const res = await fetch(`${API_URL}/usuarios`);
        const usuarios = await res.json();
        const ul = document.getElementById("usuarios");
        const loading = document.getElementById("loading");

        if (usuarios.length === 0) {
          loading.innerHTML = '<p style="color: #999; text-align: center;">No hay usuarios registrados aÃºn ğŸ˜”</p>';
          return;
        }

        loading.style.display = 'none';
        ul.style.display = 'grid';

        ul.innerHTML = usuarios.map(u => `
          <li>
            <b>${u.nombre}</b>
            <div style="margin-top: 8px; color: #666;">
              <span style="background: #667eea; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase;">
                ${u.rol}
              </span>
            </div>
            <div style="margin-top: 8px; color: #888; font-size: 14px;">
              ğŸ“§ ${u.email}
            </div>
            <div style="margin-top: 10px;">
              <button onclick="editarUsuario(${u.id_usuario}, '${u.nombre}', '${u.email}', '${u.rol}')">âœï¸ Editar</button>
              <button onclick="eliminarUsuario(${u.id_usuario})" style="background:#ff4d4f;">ğŸ—‘ Eliminar</button>
            </div>
          </li>
        `).join("");
      } catch (error) {
        document.getElementById("loading").innerHTML = 
          '<p style="color: red; text-align: center;">âŒ Error al cargar usuarios. Verifica que el servidor estÃ© ejecutÃ¡ndose.</p>';
      }
    }

    // ğŸ§® Editar usuario
    function editarUsuario(id, nombre, email, rol) {
      const nuevoNombre = prompt("Nuevo nombre:", nombre);
      const nuevoEmail = prompt("Nuevo email:", email);
      const nuevoRol = prompt("Nuevo rol (empleador/empleado):", rol);
      if (!nuevoNombre || !nuevoEmail || !nuevoRol) return alert("âš ï¸ Campos incompletos.");

      fetch(`${API_URL}/usuarios/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nombre: nuevoNombre, email: nuevoEmail, rol: nuevoRol })
      })
      .then(() => {
        alert("âœ… Usuario actualizado correctamente.");
        location.reload();
      });
    }

    // ğŸ—‘ Eliminar usuario
    async function eliminarUsuario(id) {
      if (!confirm("Â¿Eliminar este usuario?")) return;
      await fetch(`${API_URL}/usuarios/${id}`, { method: "DELETE" });
      alert("âœ… Usuario eliminado correctamente.");
      location.reload();
    }

    cargarUsuarios();
  </script>
</body>
</html>
